{% extends "base.html" %}
{% block content %}


    <div class="col-md-1"></div>
    <div class="col-md-9">
        <ul class="nav nav-tabs" >
            <li role="presentation" id="MyClass" class="active"><a><span onclick="choice_table('MyClass')">班级表class</span></a></li>
            <li role="presentation" id="MyStudent" ><a><span onclick="choice_table('MyStudent')">学生表student</span></a></li>
            <li role="presentation" id="MyTeacher"><a><span onclick="choice_table('MyTeacher')">教师表teacher</span></a></li>
            <li role="presentation" id="MyCourse"><a><span onclick="choice_table('MyCourse')">课程表course</span></a></li>
            <li role="presentation" id="MyScore"><a><span onclick="choice_table('MyScore')">成绩表score</span></a></li>
        </ul>
        <div style=" overflow:scroll; width:100%; height:300px;">
            <table id="table" class="table table-striped">
                {{ table_html | safe }}
            </table>
        </div>
        <br><hr>

        <div class="col-md-2">
            <div class="input-group">
                <span class="input-group-addon">第</span>
                <input type="text" id="number" class="form-control"  value="1">
                <span class="input-group-addon">题</span>

                <!--
                <input  onclick="getquestion()"  type="button"  class="btn btn-default" value="确定">-->
            </div>
        </div>

        <div class="col-md-10" style="text-align:right">

            <input  onclick="getanswer()" type="button"  class="btn btn-default" value="看答案">
            <input  onclick="getnowquestion()"  type="button"  class="btn btn-default" value="确定">
        </div>

        <br>
        <br>
        <br>

        <div style="width:10%;height:150px;background-color: #ededed;float: left;display: table-cell;vertical-align: middle;text-align: left;">
            {% load staticfiles %}
            <img onclick="previous()" style="width:80px;height:80px;margin-top:30px;margin-bottom: 30px;" src="{% static 'shangyige.png' %}">
        </div>

        <div class="jumbotron" style="width:80%;height:150px;float: left;margin-bottom: 0px;">
            <div class="container">
                <p id="question">本校一共多少学生？</p>
            </div>
        </div>
        <div style="width:10%;height:150px;background-color: #ededed;float: left;display: table-cell;vertical-align: middle;text-align: right;">
            {% load staticfiles %}
            <img onclick="next()" style="width:80px;height:80px;margin-top:30px;margin-bottom: 30px;" src="{% static 'xiayige.png' %}">
        </div>
        <input style="display: none;" id="questionid" name="questionid" value="0">
        <form >
        <div class="form-group">
            <label for="mysql" style="margin-top:30px">MySQL:</label>
            <textarea id="mysql" name="mysql" class="form-control" style="width: 100%;height: 130px;font-size:18px;"></textarea>
            <br>
            <div style="text-align:right">
                <input type="button" class="btn btn-default" onclick="uploadmysql()" value="提交">
            </div>
        </div>
        </form>
    </div>
    <div class="col-md-2"></div>



  <script type="application/javascript">

      function choice_table(id_name) {
          $("#MyClass").removeClass("active");
          $("#MyStudent").removeClass("active");
          $("#MyTeacher").removeClass("active");
          $("#MyCourse").removeClass("active");
          $("#MyScore").removeClass("active");

          $("#" + id_name).addClass("active");
          $.ajax({
              type: "get",
              dataType: "json",
              url: '/sqlobj/gettable/?tablename=' + id_name,
              success: function (data) {
                  $("#table").html(data.table_html)
              }

          })
      }

      function getnowquestion(){
          var number = $("#number").val();
          getquestion(number);
      }
      function getquestion(number){

          $.ajax({
              type: "get",
              dataType: "json",
              url: '/sqlobj/getquestion/?question=' + number,
              success: function (data) {
                  $("#question").text(data.question);
                  $("#questionid").val(data.id);
                  $("#number").val(data.id);
                  $("#mysql").val('');
              }

          })

      }

      function getanswer(){
          var questionid = $("#questionid").val();
          $.ajax({
              type:'GET',
              dataType: "json",
              url:'/sqlobj/getanswer/',
              data:{"questionid":questionid},
              success:function(data){
                  $("#mysql").val(data.html);
                  }
          })
      }
      function uploadmysql(){
          var questionid = $("#questionid").val();
          var mysql = $("#mysql").val();
          $.ajax({
              type:'POST',
              dataType: "json",
              url:'/sqlobj/uploadmysql/',
              data:{"mysql":mysql,"questionid":questionid},
              success:function(data){
                  if(data.head == 'ok'){
                      $("#huadong").css("background-color","#dff0d8");
                      $("#huadong").css("border-color","#d6e9c6;");
                  }else{

                      $("#huadong").css("background-color","#edd");
                      $("#huadong").css("border-color","#eed;");
                  }

                  $("#alert").html(data.info);
                  $("#huadong").css("display","block");
                  setTimeout(function() { $("#huadong").css("display","none"); }, 2000);

              }

          })
      }
      function previous(){
          var qid = parseInt($("#questionid").val())-1;
          getquestion(qid)

      }

      function next(){
          var qid = parseInt($("#questionid").val())+1;
          getquestion(qid)

      }


  window.onload=function(){ getnowquestion(); scrop();}

      function scrop(){
        var the_hight_px = $(this).scrollTop();
        $("#huadong").css("top",the_hight_px+"px");

        $(window).scroll(function() {
            var the_hight_px = $(this).scrollTop();
                $("#huadong").css("top",the_hight_px+"px");
        });

        /*
        document.addEventListener("touchmove", touchMove, false);
        function touchMove(event){
            var wl = $(this).scrollTop();
            if (wl >= hdgd){
                $("#huadong").css("z-index","10");
                $("#huadong").css("top",wl-py+"px");
            }else{
                $("#huadong").css("z-index","-10");
            }
        };*/
    }

  </script>
{% endblock %}